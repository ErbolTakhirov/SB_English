# ü§ñ AI ENHANCEMENTS - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º

## üìã –û–±–∑–æ—Ä

–ù–æ–≤–∞—è AI-—Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤–∞—à —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ **–ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É —É–º–Ω–æ–≥–æ —Å–æ–≤–µ—Ç—á–∏–∫–∞**, –∫–æ—Ç–æ—Ä—ã–π:
- üéØ –ü–æ–Ω–∏–º–∞–µ—Ç **–∫–æ–Ω—Ç–µ–∫—Å—Ç** –∏ **–Ω–∞–º–µ—Ä–µ–Ω–∏—è** –≤–æ–ø—Ä–æ—Å–æ–≤
- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ—Ç **—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
- üí° –î–∞–µ—Ç **–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** —Å–æ–≤–µ—Ç—ã
- üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **–ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è**
- üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç **–ø—Ä–æ–≥—Ä–µ—Å—Å** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         USER QUERY (–í–æ–ø—Ä–æ—Å)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  QUERY ANALYZER        ‚îÇ
    ‚îÇ  –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ ‚îÇ
    ‚îÇ  (—Ç—Ä–µ–Ω–¥—ã/–∞–Ω–æ–º–∞–ª–∏–∏/etc) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   CONTEXT BUILDER                      ‚îÇ
    ‚îÇ   –°–±–æ—Ä —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:             ‚îÇ
    ‚îÇ   - –¢–∞–±–ª–∏—Ü—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞               ‚îÇ
    ‚îÇ   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º             ‚îÇ
    ‚îÇ   - –¢—Ä–µ–Ω–¥—ã –∏ –∞–Ω–æ–º–∞–ª–∏–∏                  ‚îÇ
    ‚îÇ   - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è               ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   ENHANCED ADVISOR       ‚îÇ
    ‚îÇ   –£–º–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π       ‚îÇ
    ‚îÇ   —Å–æ–≤–µ—Ç–Ω–∏–∫ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   LLM (OpenRouter/Ollama)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô      ‚îÇ
    ‚îÇ   –û–¢–í–ï–¢ –° –°–û–í–ï–¢–ê–ú–ò       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **Query Analyzer** (`core/ai/query_analyzer.py`)

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:

**–¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
- `trends` - –¢—Ä–µ–Ω–¥—ã –∏ –¥–∏–Ω–∞–º–∏–∫–∞
- `anomalies` - –ê–Ω–æ–º–∞–ª–∏–∏ –∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–∞—Ç—ã
- `advice` - –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `comparison` - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
- `forecast` - –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
- `specific` - –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è/–∫–∞—Ç–µ–≥–æ—Ä–∏—è
- `goals` - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏
- `general` - –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

**–ò–∑–≤–ª–µ–∫–∞–µ—Ç:**
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–µ–¥–∞, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, etc.)
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü, –≥–æ–¥, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞)
- ‚úÖ –°—É–º–º—ã –∏ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from core.ai.query_analyzer import analyze_query

result = analyze_query("–ü–æ—á–µ–º—É —Ç–∞–∫ –≤—ã—Ä–æ—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≤ –ø—Ä–æ—à–ª–æ–º –º–µ—Å—è—Ü–µ?")

# result = {
#     'query_type': 'anomalies',
#     'categories': ['–º–∞—Ä–∫–µ—Ç–∏–Ω–≥'],
#     'time_period': {
#         'type': 'specific_month',
#         'start_date': date(2024, 11, 1),
#         'end_date': date(2024, 11, 30)
#     },
#     'context_priority': ['anomalies', 'transactions', 'tables'],
#     'requires_deep_search': True
# }
```

---

### 2. **Context Builder** (`core/ai/context_builder.py`)

–°—Ç—Ä–æ–∏—Ç –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–∞.

**–°–æ–±–∏—Ä–∞–µ—Ç:**
- üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–µ—Ä–∏–æ–¥—É)
- üìà –¢—Ä–µ–Ω–¥—ã –∑–∞ 3+ –º–µ—Å—è—Ü–µ–≤
- üîç –ê–Ω–æ–º–∞–ª–∏–∏ –∏ –Ω–µ–æ–±—ã—á–Ω—ã–µ —Ç—Ä–∞—Ç—ã
- üí∞ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç–∏–ø, –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

**–ü—Ä–∏–º–µ—Ä:**
```python
from core.ai.context_builder import build_enriched_context

query_analysis = analyze_query("–î–∞–π —Å–æ–≤–µ—Ç –∫–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å")
context = build_enriched_context(user, query_analysis)

# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç markdown-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
# ## üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# **–ü–µ—Ä–∏–æ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:** 6 –º–µ—Å—è—Ü(–µ–≤)
# **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç–∏–ø:** –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä (—Ä–∞–∑—É–º–Ω—ã–µ —Ç—Ä–∞—Ç—ã)
# 
# ## üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
# [–¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏]
# ...
```

---

### 3. **Enhanced Financial Advisor** (`core/ai/advisor.py`)

–ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç - —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç—á–∏–∫.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- üí° –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã (üî• –°–ï–ô–ß–ê–°, üìÜ –≠–¢–û–¢ –ú–ï–°–Ø–¶, üîÆ –ë–£–î–£–©–ï–ï)
- üîç –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è (üö® –°–†–û–ß–ù–û, ‚ö° QUICK WIN, üìÖ –î–û–õ–ì–û–°–†–û–ß–ù–û)

**–ü—Ä–∏–º–µ—Ä:**
```python
from core.ai.advisor import get_financial_advice

result = get_financial_advice(
    user=request.user,
    query="–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –º–æ—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Å–∏—Ç—É–∞—Ü–∏—é?",
    session=chat_session,
    use_local=False,
    anonymize=True
)

# result = {
#     'response': "## üéØ –ë–´–°–¢–†–´–ô –í–´–í–û–î\n...",
#     'query_type': 'advice',
#     'context_used': {...},
#     'metadata': {...}
# }
```

---

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å URL –º–∞—Ä—à—Ä—É—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ `core/urls.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π endpoint:

```python
from core.ai.views import ai_chat_api_v2

urlpatterns = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã ...
    
    # –ù–æ–≤—ã–π —É–ª—É—á—à–µ–Ω–Ω—ã–π AI chat API
    path('api/ai/chat/v2/', ai_chat_api_v2, name='ai_chat_v2'),
]
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å frontend

–í `workspace.html` (–∏–ª–∏ –≤–∞—à–µ–º —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ), –∏–∑–º–µ–Ω–∏—Ç–µ URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:

**–°—Ç–∞—Ä—ã–π –∫–æ–¥:**
```javascript
fetch('/ai/chat/', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
    },
    body: JSON.stringify({
        message: userMessage,
        session_id: currentSessionId
    })
})
```

**–ù–æ–≤—ã–π –∫–æ–¥ (—Å v2):**
```javascript
fetch('/api/ai/chat/v2/', {  // –ò–∑–º–µ–Ω–µ–Ω URL
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
    },
    body: JSON.stringify({
        message: userMessage,
        session_id: currentSessionId,
        use_local: false,  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
        anonymize: true    // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    })
})
.then(response => response.json())
.then(data => {
    console.log('Query Type:', data.query_type);
    console.log('Context Used:', data.context_used);
    console.log('Actionable Items:', data.actionable_items);
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Ç–≤–µ—Ç
    displayMessage('assistant', data.reply);
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–≤–µ—Ç—ã –ø–æ —Å–µ–∫—Ü–∏—è–º
    displayAdviceBySection(data.actionable_by_section);
})
```

### –®–∞–≥ 3: –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–î–æ–±–∞–≤—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–≤–µ—Ç–æ–≤ –ø–æ —Å–µ–∫—Ü–∏—è–º:

```javascript
function displayAdviceBySection(adviceBySection) {
    const urgentAdvices = adviceBySection.urgent || [];
    const quickWins = adviceBySection.quick_win || [];
    const nowAdvices = adviceBySection.now || [];
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ä–æ—á–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
    if (urgentAdvices.length > 0) {
        const urgentHtml = `
            <div class="alert alert-danger">
                <h5>üö® –°–†–û–ß–ù–û</h5>
                <ul>
                    ${urgentAdvices.map(a => `<li>${a.text}</li>`).join('')}
                </ul>
            </div>
        `;
        document.getElementById('advices-container').innerHTML += urgentHtml;
    }
    
    // Quick wins
    if (quickWins.length > 0) {
        const quickWinHtml = `
            <div class="alert alert-success">
                <h5>‚ö° QUICK WINS</h5>
                <ul>
                    ${quickWins.map(a => `<li>${a.text}</li>`).join('')}
                </ul>
            </div>
        `;
        document.getElementById('advices-container').innerHTML += quickWinHtml;
    }
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤

**–ó–∞–ø—Ä–æ—Å:**
```
–ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –º–æ–∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞?
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Query Analyzer –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: `query_type = 'trends'`
2. Context Builder —Å–æ–±–∏—Ä–∞–µ—Ç:
   - –¢–∞–±–ª–∏—Ü—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞
   - –¢—Ä–µ–Ω–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
3. Advisor –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:
   ```markdown
   ## üéØ –ë–´–°–¢–†–´–ô –í–´–í–û–î
   –†–∞—Å—Ö–æ–¥—ã –≤—ã—Ä–æ—Å–ª–∏ –Ω–∞ 23% (—Å 45,000 –¥–æ 55,300), 
   –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—Å—Ç –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥" (+47%).
   
   ## üìä –ö–õ–Æ–ß–ï–í–´–ï –ù–ê–•–û–î–ö–ò
   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥": üìà +47% (15,000 ‚Üí 22,000)
   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–û—Ñ–∏—Å": ‚û°Ô∏è —Å—Ç–∞–±–∏–ª—å–Ω–æ (~8,000)
   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç": üìâ -15% (12,000 ‚Üí 10,200)
   
   ## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
   
   ### üî• –°–ï–ô–ß–ê–°:
   1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å ROI –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
   2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥: 18,000/–º–µ—Å—è—Ü
   ```

### –ü—Ä–∏–º–µ—Ä 2: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π

**–ó–∞–ø—Ä–æ—Å:**
```
–ü–æ—á–µ–º—É —è –ø–æ—Ç—Ä–∞—Ç–∏–ª —Ç–∞–∫ –º–Ω–æ–≥–æ –≤ –Ω–æ—è–±—Ä–µ?
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Query Analyzer: `query_type = 'anomalies'`
2. Context Builder:
   - –ù–∞—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ –Ω–æ—è–±—Ä—å
   - –í—ã—è–≤–ª—è–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ (z-score > 2)
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–æ —Å—Ä–µ–¥–Ω–∏–º
3. Advisor –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
   ```markdown
   ## üîç –ê–ù–û–ú–ê–õ–ò–ò
   - 15.11: 35,000 –Ω–∞ "–†–µ–∫–ª–∞–º–∞" (–æ–±—ã—á–Ω–æ ~12,000)
   - 23.11: 18,500 –Ω–∞ "–û—Ñ–∏—Å" (–æ–±—ã—á–Ω–æ ~8,000)
   
   ## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–û–ú–ï–ù–¢–´
   –†–∞—Å—Ö–æ–¥—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –Ω–æ—Ä–º—É –Ω–∞ 67%!
   
   ### üî• –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°:
   1. –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ç–¥–µ–ª–æ–º –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ - –≤—ã—è—Å–Ω–∏—Ç—å 
      –ø—Ä–∏—á–∏–Ω—É —Ç—Ä–∞—Ç—ã 35,000 –Ω–∞ —Ä–µ–∫–ª–∞–º—É
   2. –í–Ω–µ–¥—Ä–∏—Ç—å approval process –¥–ª—è —Ç—Ä–∞—Ç >15,000
   ```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≥–Ω–æ–∑ –∏ —Ü–µ–ª–∏

**–ó–∞–ø—Ä–æ—Å:**
```
–°–∫–æ–ª—å–∫–æ –º–Ω–µ –Ω—É–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å —á—Ç–æ–±—ã —á–µ—Ä–µ–∑ 6 –º–µ—Å—è—Ü–µ–≤ 
–∫—É–ø–∏—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∑–∞ 300,000?
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Query Analyzer: `query_type = 'forecast'`, `amounts = [300000]`
2. Context Builder:
   - –¢–µ–∫—É—â–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å
   - –¢—Ä–µ–Ω–¥—ã –ø—Ä–∏–±—ã–ª–∏
3. Advisor —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç:
   ```markdown
   ## üìà –ü–†–û–ì–ù–û–ó
   –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: 145,000 (+25,000/–º–µ—Å—è—Ü)
   –¶–µ–ª—å —á–µ—Ä–µ–∑ 6 –º–µ—Å—è—Ü–µ–≤: 300,000
   
   –ù—É–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å: 155,000
   –¢—Ä–µ–±—É–µ—Ç—Å—è: 25,833/–º–µ—Å—è—Ü
   
   ## üí° –ü–õ–ê–ù –î–û–°–¢–ò–ñ–ï–ù–ò–Ø
   
   ### üî• –°–ï–ô–ß–ê–°:
   1. –¢–µ–∫—É—â–∏—Ö —Ç–µ–º–ø–æ–≤ —Ö–≤–∞—Ç–∏—Ç! (25,000/–º–µ—Å—è—Ü)
   2. –†–µ–∑–µ—Ä–≤: +833/–º–µ—Å—è—Ü –¥–ª—è –ø–æ–¥—É—à–∫–∏
   
   ### üìÜ –í –≠–¢–û–ú –ú–ï–°–Ø–¶–ï:
   1. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—á–µ—Ç "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
   2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥ 26,000/–º–µ—Å—è—Ü
   ```

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ `core/ai/advisor.py`:

```python
ADVANCED_FINANCIAL_PROMPT = """
–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫...

# –î–û–ë–ê–í–¨–¢–ï –°–í–û–ò –ò–ù–°–¢–†–£–ö–¶–ò–ò –ó–î–ï–°–¨

## –ù–û–í–´–ï –ü–†–ê–í–ò–õ–ê:
- ...
- ...
"""
```

---

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∞–Ω–∞–ª–∏–∑–∞

1. **–î–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø –≤ Query Analyzer:**

```python
class QueryType:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
    INVESTMENTS = 'investments'  # –ù–æ–≤—ã–π —Ç–∏–ø
```

2. **–î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:**

```python
KEYWORDS = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
    QueryType.INVESTMENTS: [
        '–∏–Ω–≤–µ—Å—Ç–∏—Ü', '–∞–∫—Ü–∏', '–æ–±–ª–∏–≥–∞—Ü', '–ø–æ—Ä—Ç—Ñ–µ–ª—å',
        'invest', 'stocks', 'bonds', 'portfolio'
    ],
}
```

3. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ü–∏—é –≤ Context Builder:**

```python
def _build_investments_section(self):
    # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
    return "## üíº –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏\n..."
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:

```python
session.action_log = {
    'advices_given': 42,           # –í—Å–µ–≥–æ —Å–æ–≤–µ—Ç–æ–≤
    'advices_completed': 15,       # –í—ã–ø–æ–ª–Ω–µ–Ω–æ
    'total_messages': 28,          # –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π
    'query_types': [               # –ò—Å—Ç–æ—Ä–∏—è —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
        {'type': 'trends', 'timestamp': '...'},
        {'type': 'advice', 'timestamp': '...'},
    ],
    'all_advices': [...]           # –í—Å–µ —Å–æ–≤–µ—Ç—ã —Å –¥–µ—Ç–∞–ª—è–º–∏
}
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è dashboard:
```python
completion_rate = advices_completed / advices_given * 100
print(f"Completion Rate: {completion_rate}%")
```

---

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (–¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö)

–ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π >10,000, –¥–æ–±–∞–≤—å—Ç–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫:

```bash
pip install sentence-transformers chromadb
```

```python
# core/ai/vector_search.py
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('paraphrase-multilingual-MiniLM-L12-v2')

def search_similar_transactions(query, transactions, top_k=5):
    query_embedding = model.encode([query])
    # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
```

### 2. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏ (Goals)

–°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å Goals:

```python
# core/models.py
class FinancialGoal(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    title = models.CharField(max_length=200)
    target_amount = models.FloatField()
    deadline = models.DateField()
    current_amount = models.FloatField(default=0)
    created_at = models.DateTimeField(auto_now_add=True)
```

### 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã:

```python
PROMPTS = {
    'v1': "...",
    'v2': "...",
}

prompt_version = 'v2' if user.id % 2 == 0 else 'v1'
```

---

## ‚ùì FAQ

**Q: –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API?**  
A: –ù–µ—Ç! –°—Ç–∞—Ä—ã–π `/ai/chat/` –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ù–æ–≤—ã–π `/api/ai/chat/v2/` - —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ.

**Q: –°–æ–≤–º–µ—Å—Ç–∏–º–æ –ª–∏ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é (Ollama)?**  
A: –î–∞! –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ `use_local=True`.

**Q: –ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**  
A: –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ. Query Analyzer —Ä–∞–±–æ—Ç–∞–µ—Ç ~10ms, Context Builder ~50-100ms.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ LLM?**  
A: –î–∞! –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º LLM —á–µ—Ä–µ–∑ OpenRouter –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ.

---

## üìö –†–µ—Å—É—Ä—Å—ã

- [OpenRouter Models](https://openrouter.ai/models)
- [Ollama](https://ollama.ai/)
- [Prompt Engineering Guide](https://www.promptingguide.ai/)

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è SB Finance AI**
